# FOUND File Analyzer

A command-line tool for reading and analyzing metadata in `.found` files generated by the FOUND satellite positioning system.

## Overview

The FOUND File Analyzer is a Python utility that can extract, display, and analyze the contents of `.found` files. These binary files contain calibration data, relative attitude information (as quaternions), and position records with timestamps.

## Features

- **Header Analysis**: Extracts and validates file metadata including magic number, version, position count, and CRC32 checksums
- **Integrity Checking**: Verifies file integrity using CRC32 validation
- **Attitude Analysis**: Reads and displays relative attitude information stored as quaternions
- **Position Data**: Extracts and analyzes location records with timestamps and 3D coordinates
- **Statistical Analysis**: Calculates distance statistics, time spans, and other metrics
- **Multiple Output Formats**: Human-readable summary, JSON export, or integrity-check-only mode

## Installation

1. **Environment Setup**: Create the Python environment using the provided configuration:
   ```bash
   # From the FOUND root directory
   ./tools/setup-tools-envs.sh
   ```

2. **Activate Environment**:
   ```bash
   micromamba activate analyzer_env
   # or conda activate analyzer_env
   ```

## Usage

### Basic Analysis

Analyze a `.found` file and display a comprehensive summary:

```bash
python -m tools.analyzer calibration.found
```

### Command Line Options

```bash
python -m tools.analyzer [OPTIONS] <file.found>

Options:
  -h, --help            Show help message
  -j, --json FILE       Export analysis results to JSON file
  -c, --check-only      Only check file integrity (exit code indicates success/failure)
  -v, --verbose         Show verbose output including all position records
```

### Examples

```bash
# Basic analysis with summary
python -m tools.analyzer example-df.found

# Export detailed analysis to JSON
python -m tools.analyzer --json analysis.json satellite-data.found

# Quick integrity check (useful for scripts)
python -m tools.analyzer --check-only suspicious.found
echo $?  # 0 = valid, 1 = invalid

# Verbose output showing all position records
python -m tools.analyzer --verbose detailed-positions.found
```

## Output Format

### Summary Display

The tool provides a structured summary including:

```
=== FOUND File Analysis: example.found ===
File size: 1234 bytes

ðŸ“„ Header Information:
  Magic: FOUN
  Version: 1
  Number of positions: 10
  CRC: 0x12345678
  CRC Valid: âœ…

ðŸ§­ Relative Attitude (Quaternion):
  Real: 0.965926
  i: 0.000000
  j: 0.258819
  k: 0.000000
  Magnitude: 1.000000
  Unit quaternion: âœ…

ðŸ“ Position Records: 10 found
  Recent positions:
    [6] t=1234567890, pos=(100.123, 200.456, 300.789), dist=374.166
    [7] t=1234567891, pos=(101.234, 201.567, 301.890), dist=375.277
    ...

ðŸ“Š Statistics:
  Distance range: 100.000 to 500.000
  Average distance: 350.123
  Time span: 1000000 microseconds
  Duration: 1.00 seconds
```

### JSON Export

When using `--json`, the tool exports a structured JSON file containing:

```json
{
  "file_path": "example.found",
  "file_size": 1234,
  "header": {
    "magic": "FOUN",
    "version": 1,
    "num_positions": 10,
    "crc": 305419896,
    "calculated_crc": 305419896,
    "crc_valid": true
  },
  "relative_attitude": {
    "real": 0.965926,
    "i": 0.0,
    "j": 0.258819,
    "k": 0.0,
    "magnitude": 1.0
  },
  "position_records": [
    {
      "index": 0,
      "timestamp": 1234567890,
      "position": {"x": 100.123, "y": 200.456, "z": 300.789},
      "distance_from_origin": 374.166
    }
  ],
  "statistics": {
    "min_distance": 100.0,
    "max_distance": 500.0,
    "avg_distance": 350.123,
    "time_span": 1000000
  }
}
```

## File Format Understanding

The tool understands the binary `.found` file format:

1. **Header (16 bytes)**:
   - Magic number: "FOUN" (4 bytes)
   - Version: uint32 (4 bytes, network byte order)
   - Position count: uint32 (4 bytes, network byte order)
   - CRC32: uint32 (4 bytes, network byte order)

2. **Relative Attitude (32 bytes)**:
   - Quaternion: 4 Ã— double (8 bytes each, network byte order)
   - Components: real, i, j, k

3. **Position Records (32 bytes each)**:
   - Timestamp: uint64 (8 bytes, network byte order)
   - Position: 3 Ã— double (8 bytes each, network byte order)
   - Components: timestamp, x, y, z

## Error Handling

The tool provides clear error messages for common issues:

- **File not found**: Clear file path error
- **Invalid magic number**: File is not a `.found` file
- **CRC mismatch**: File corruption detected
- **Truncated data**: File appears incomplete
- **Read errors**: Specific location where parsing failed

## Integration with FOUND

This tool complements the main FOUND system by providing:

- **Debugging support**: Verify calibration files are correct
- **Data validation**: Check integrity of position data
- **Analysis workflows**: Extract data for external analysis
- **Quality assurance**: Validate outputs from FOUND algorithms

## Dependencies

- Python >= 3.9
- Standard library only (no external dependencies required)
  - `struct` for binary data parsing
  - `zlib` for CRC32 validation
  - `json` for export functionality
  - `argparse` for command-line interface

## Exit Codes

- `0`: Success
- `1`: File error (not found, invalid format, or corruption detected)

This makes the tool suitable for use in automated scripts and CI/CD pipelines.
